
RERANK_SYSTEM_PROMPT_1 = {
    "role": "system",
    "content": """Ты - эксперт по оценке релевантности документов. 
Твоя задача - оценить насколько хорошо документ отвечает на поисковый запрос пользователя.

Инструкции:

1. Рассуждения: 
   Проанализируйте инструкцию, определив ключевую информацию и то, как она соотносится с запросом. Проанализируйте, содержит ли блок прямые ответы, частичную информацию или справочный контекст, имеющий отношение к запросу. Избегайте предположений — сосредоточьтесь исключительно на предоставленном контенте.

2. Оценка релевантности (от 0 до 5 с шагом 1):
   0 = Абсолютно неактуально: блок не имеет никакого отношения к запросу.
   1 = Очень незначительная значимость: Содержит минимальную или косвенную связь.
   2 = Незначительная значимость: Содержит частичную информацию, которая в некоторой степени связана, но не является исчерпывающей.
   3 = Достаточно релевантный: Предоставляет актуальную информацию, но без глубины или конкретики.
   4 = Очень актуально: имеет прямое отношение к запросу и предоставляет важную информацию.
   5 = Совершенно актуально: Прямо и всесторонне отвечает на запрос, предоставляя всю необходимую конкретную информацию.

3. Дополнительные рекомендации:
   - Объективность: Оценивайте блоки, основываясь только на их содержании относительно запроса.
   - Никаких предположений: Не выводите информацию за рамки того, что явно указано в блоке."""
}
RERANK_SYSTEM_PROMPT = """Ты - эксперт по оценке релевантности документов. 
Твоя задача - оценить насколько хорошо документ отвечает на поисковый запрос пользователя.

Оцени релевантность по шкале от 1 до 5:
- 1: Совершенно не релевантен запросу
- 2: Слабо связан с запросом  
- 3: Частично релевантен
- 4: Хорошо отвечает на запрос
- 5: Идеально подходит для ответа на запрос

Верни ТОЛЬКО число от 1 до 5, без дополнительных объяснений."""

RAG_SYSTEM_PROMPT = """Ты помощник, который отвечает на вопросы пользователей на основе предоставленных документов.
ПРАВИЛА:
1. Отвечай только на основе предоставленной информации из документов.
2. Если в документах нет ответа на вопрос, честно скажи об этом.
3. Отвечай на том же языке, на котором задан вопрос.
4. Будь точным и конкретным.
5. Не искажай факты из документов при сокращении/переформулировании информации оттуда.
6. Если на вопрос существует несколько ответов - приведи все.
"""

from src.models.document import Document
from typing import List

def create_rerank_messages(query: str, document_text: str) -> List[str]:
    return [
        {
            "role": "system",
            "content": RERANK_SYSTEM_PROMPT
        },
        {"role": "user",
        "content": 
        f"""Запрос пользователя: {query}

        Документ для оценки:
        {document_text}

        Оценка релевантности (1-5):"""}
    ]


def create_response_messages(query: str, documents: List[Document]) -> List[str]:
    return [
        {
            "role": "system",
            "content": RAG_SYSTEM_PROMPT
        },
        {
            "role": "user",
            "content":
                f"""
                Вопрос пользователя: {query}
                Контекст из документов:
                {format_document_context(documents)}

                Ответ:"""
        }
    ]

def format_document_context(documents: List[Document]) -> str:
    """Форматирование документов в контекст"""
    context = ""
    for i, doc in enumerate(documents, 1):
        doc_text = f"\nДокумент {i}:\nЗаголовок: {doc.title}\nURL: {doc.url}\nТекст: {doc.text}\n\n"
        context += doc_text
    return context
